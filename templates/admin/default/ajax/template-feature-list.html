<div class="form-group">
    {ifloop rel="free_features"}
    <form action="{url path='/admin/configuration/templates/features/add'}">

        <input type="hidden" name="template_id" value="{$template_id}" />

	    <div class="input-group">
	        <select required="required" name="feature_id" id="feature_id" class="form-control">
		        <option value="">Select an feature...</option>
		        {loop name="free_features" type="feature" exclude_template="$template_id" backend_context="1" lang="$edit_language_id"}
		            <option value="{$ID}">{$TITLE}</option>
		        {/loop}
		    </select>
		    <span class="input-group-btn">
		       <button class="btn btn-default btn-primary action-btn" type="submit"><span class="glyphicon glyphicon-plus-sign"></span></button>
		    </span>
	    </div>

	    <span class="help-block">{intl l='Select an feature and click (+) to add it to this template'}</span>
    </form>

    {/ifloop}
    {elseloop rel="free_features"}
    <div class="alert alert-info">There is currently no available features.</div>
    {/elseloop}
</div>

<div class="table-responsive">
    <table class="table table-striped table-condensed table-left-aligned">
    <thead>
        <tr>
            <th>{intl l='ID'}</th>

            <th>{intl l='Feature title'}</th>

            {module_include location='template_features_table_header'}

            <th class="actions">{intl l="Actions"}</th>
        </tr>
    </thead>

    <tbody>
        {loop name="assigned_features" type="feature" template="$template_id" backend_context="1" lang="$edit_language_id"}
        <tr>
            <td>{$ID}</td>

            <td>
                {$TITLE}
            </td>

            {module_include location='template_features_table_row'}

            <td class="actions">
                <div class="btn-group">
                    {loop type="auth" name="can_create" roles="ADMIN" permissions="admin.configuration.template.feature.delete"}
                       <a class="btn btn-default btn-xs delete-feature" title="{intl l='Delete this feature'}" href="#delete_feature_dialog" data-id="{$ID}" data-toggle="modal">
                        <span class="glyphicon glyphicon-trash"></span>
                       </a>
                    {/loop}
                </div>
            </td>
        </tr>
         {/loop}

         {elseloop rel="assigned_features"}
             <tr>
                 <td colspan="3">
                     <div class="alert alert-info">
                         {intl l="This template contains no features"}
                     </div>
                 </td>
             </tr>
         {/elseloop}
        </tbody>
    </table>
</div>

{* Delete value confirmation dialog *}

{capture "delete_feature_dialog"}
    <input type="hidden" name="template_id" value="{$template_id}" />
    <input type="hidden" name="feature_id" id="feature_delete_id" value="" />
{/capture}

{include
    file = "includes/generic-confirm-dialog.html"

    dialog_id       = "delete_feature_dialog"
    dialog_title    = {intl l="Remove feature"}
    dialog_message  = {intl l="Do you really want to remove this feature from the template ?"}

    form_action     = {url path='/admin/configuration/templates/features/delete'}
    form_content    = {$smarty.capture.delete_feature_dialog nofilter}
}

<script>
    $(function() {

        // Set proper feature ID in delete feature from
        $('a.delete-feature').click(function(ev) {
            $('#feature_delete_id').val($(this).data('id'));
        });
    });
</script>
